<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mint NeoX CyberDegens — v3</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.12.0/dist/ethers.umd.min.js"></script>

<style>
    body {
        margin:0;
        padding:0;
        background: radial-gradient(circle at center, #000217, #000000 80%);
        font-family: Arial, sans-serif;
        color:#c9faff;
        text-align:center;
    }
    .header {
        padding:40px 10px 10px;
    }
    h1 {
        color:#35f0ff;
        text-shadow:0 0 25px #00eaff,0 0 60px #00eaff;
        font-size:32px;
        margin-bottom:8px;
    }
    .version {
        color:#ff00ff;
        font-weight:bold;
        font-size:18px;
        margin-top:-10px;
        margin-bottom:20px;
        text-shadow:0 0 10px #ff00ff;
    }
    .mintCard {
        width:440px;
        max-width:95vw;
        margin:30px auto 50px;
        padding:30px 20px;
        background:rgba(0,20,40,0.75);
        border:1px solid #00eaff;
        border-radius:14px;
        box-shadow:0 0 30px #0072a2, inset 0 0 25px #002b3b;
    }
    input {
        width:90px;
        padding:8px;
        text-align:center;
        border-radius:8px;
        border:1px solid #00eaff;
        background:#001a2a;
        color:#a9faff;
        font-size:16px;
    }
    button {
        padding:12px 30px;
        margin-top:12px;
        border:none;
        border-radius:8px;
        background:linear-gradient(90deg,#00eaff,#0095ff);
        color:#002233;
        font-weight:bold;
        cursor:pointer;
        box-shadow:0 0 20px #00d0ff;
    }
    button:hover { transform:scale(1.04); }
    button:disabled {
        opacity:0.5;
        cursor:not-allowed;
        box-shadow:none;
    }
    .status {
        margin-top:16px;
        font-size:13px;
        white-space:pre-line;
        opacity:0.9;
    }
</style>

</head>
<body>

<div class="header">
    <h1>Mint NeoX CyberDegens</h1>
    <div class="version">Mint Page v3</div>
</div>

<div class="mintCard">
    <p><strong>Mint Price:</strong> 10 MON</p>
    <p><strong>Quantity:</strong></p>
    <input type="number" id="qty" min="1" max="20" value="1">
    <br><br>
    <button id="connectBtn">Connect Wallet (MetaMask / Phantom)</button><br>
    <button id="mintBtn" disabled>Mint</button>

    <div id="status" class="status">Status: Idle</div>
</div>

<script>
/* ------------------ CONFIG ------------------ */

const CONTRACT_ADDRESS = "0x3902616c108f8f4b076529045aaeb338224d4da4";
const VALID_CHAIN_IDS = [143n, 228n]; // Phantom = 143, MetaMask Monad = 228
const RPC_URL = "https://rpc.monad.xyz";

const ABI = [
  "function mint(uint256 quantity) external payable",
  "function MINT_PRICE() view returns (uint256)",
  "function totalMinted() view returns (uint256)",
  "function MAX_SUPPLY() view returns (uint256)"
];

/* --------------- UTILITY FUNCTIONS ---------------- */

function log(msg) {
  document.getElementById("status").textContent = msg;
}

function getInjectedProvider() {
  // prefer phantom
  if (window.phantom && window.phantom.ethereum) return window.phantom.ethereum;

  // prefer metamask
  if (window.ethereum && window.ethereum.isMetaMask) return window.ethereum;

  // block brave wallet
  if (window.ethereum && window.ethereum.isBraveWallet) return null;

  // fallback
  return window.ethereum || null;
}

let provider, signer, contract;

/* ------------------- CONNECT BUTTON ------------------- */

document.getElementById("connectBtn").onclick = async () => {
  try {
    const injected = getInjectedProvider();
    if (!injected) {
      log("⚠ Wallet not detected. Use MetaMask or Phantom.");
      return;
    }

    const accounts = await injected.request({ method: "eth_requestAccounts" });
    const wallet = accounts[0];

    provider = new ethers.BrowserProvider(injected);
    signer = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

    const net = await provider.getNetwork();

    if (!VALID_CHAIN_IDS.includes(net.chainId)) {
      log(`⚠ Wrong network.\nChainId detected: ${net.chainId}\nRequired: 143 or 228`);
      return;
    }

    log(`✅ Connected as:\n${wallet}\nChainId: ${net.chainId}\nOK Ready to mint.`);
    document.getElementById("mintBtn").disabled = false;

  } catch (err) {
    log("❌ Connect error:\n" + (err.message || err));
  }
};

/* ---------------------- MINT BUTTON -------------------- */

document.getElementById("mintBtn").onclick = async () => {
  try {
    const qty = parseInt(document.getElementById("qty").value);
    if (!qty || qty < 1) {
      log("Enter a valid quantity.");
      return;
    }

    const price = await contract.MINT_PRICE();
    const totalCost = price * BigInt(qty);

    log("⏳ Sending transaction…");

    const tx = await contract.mint(qty, { value: totalCost });
    log("⏳ Waiting for confirmation…\nTx: " + tx.hash);

    const receipt = await tx.wait();
    log("✅ Minted successfully!\nTx: " + receipt.hash);

  } catch (err) {
    log("❌ Mint error:\n" + (err.reason || err.message || err));
  }
};
</script>

</body>
</html>
