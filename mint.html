<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mint NeoX CyberDegens</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.12.0/dist/ethers.umd.min.js"></script>

<style>
    body {
        margin:0;
        padding:0;
        background: radial-gradient(circle at center, #000217, #000000 80%);
        font-family: Arial, sans-serif;
        color:#c9faff;
        text-align:center;
    }
    .header {
        padding:40px 10px 10px;
    }
    h1 {
        color:#35f0ff;
        text-shadow:0 0 25px #00eaff,0 0 60px #00eaff;
        font-size:32px;
        margin-bottom:8px;
    }
    .subtitle {
        opacity:0.85;
        margin-bottom:4px;
    }
    .mintCard {
        width:440px;
        max-width:95vw;
        margin:30px auto 50px;
        padding:30px 20px;
        background:rgba(0,20,40,0.75);
        border:1px solid #00eaff;
        border-radius:14px;
        box-shadow:0 0 30px #0072a2, inset 0 0 25px #002b3b;
    }
    .counter {
        font-size:16px;
        margin-bottom:10px;
    }
    input {
        width:90px;
        padding:8px;
        margin-top:6px;
        text-align:center;
        border-radius:8px;
        border:1px solid #00eaff;
        background:#001a2a;
        color:#a9faff;
        font-size:16px;
    }
    button {
        padding:12px 30px;
        margin-top:12px;
        border:none;
        border-radius:8px;
        background:linear-gradient(90deg,#00eaff,#0095ff);
        color:#002233;
        font-weight:bold;
        cursor:pointer;
        box-shadow:0 0 20px #00d0ff;
    }
    button:hover { transform:scale(1.04); }
    button:disabled {
        opacity:0.5;
        cursor:not-allowed;
        box-shadow:none;
    }
    .status {
        margin-top:16px;
        font-size:13px;
        white-space:pre-line;
        opacity:0.9;
    }
</style>

</head>
<body>

<div class="header">
    <h1>Mint NeoX CyberDegens</h1>
    <p class="subtitle">Mint Price: <strong>10 MON</strong> • Network: Monad Mainnet</p>
</div>

<div class="mintCard">
    <div id="counter" class="counter">Loading supply…</div>

    <p>
        <strong>Quantity</strong><br>
        <input type="number" id="qty" min="1" max="20" value="1">
    </p>

    <button id="connectBtn">Connect Wallet (MetaMask / Phantom)</button><br>
    <button id="mintBtn" disabled>Mint</button>

    <div id="status" class="status">Status: Idle</div>
</div>

<script>
const CONTRACT_ADDRESS = "0x3902616c108f8f4b076529045aaeb338224d4da4"; // all lowercase: no checksum issues
const MONAD_RPC = "https://rpc.monad.xyz";
const MONAD_CHAIN_ID = 143n;

const ABI = [
  "function mint(uint256 quantity) external payable",
  "function MINT_PRICE() view returns (uint256)",
  "function totalMinted() view returns (uint256)",
  "function MAX_SUPPLY() view returns (uint256)"
];

let browserProvider, signer, contract, walletAddress;

function log(msg) {
  document.getElementById("status").textContent = msg;
}

function setMintEnabled(enabled) {
  document.getElementById("mintBtn").disabled = !enabled;
}

// pick Phantom EVM first, then MetaMask
function getInjectedProvider() {
  if (window.phantom && window.phantom.ethereum) return window.phantom.ethereum;
  if (window.ethereum) return window.ethereum;
  return null;
}

// supply counter using public RPC (no wallet needed)
async function updateCounter() {
  try {
    const rpcProvider = new ethers.JsonRpcProvider(MONAD_RPC);
    const viewContract = new ethers.Contract(CONTRACT_ADDRESS, ABI, rpcProvider);
    const minted = await viewContract.totalMinted();
    const max = await viewContract.MAX_SUPPLY();
    document.getElementById("counter").textContent =
      `Minted: ${minted.toString()} / ${max.toString()}`;
  } catch (e) {
    document.getElementById("counter").textContent = "Minted: ? / 10000";
  }
}
updateCounter();

// connect wallet
document.getElementById("connectBtn").onclick = async () => {
  try {
    const injected = getInjectedProvider();
    if (!injected) {
      log("⚠ No MetaMask / Phantom wallet detected.");
      return;
    }

    const accounts = await injected.request({ method: "eth_requestAccounts" });
    walletAddress = accounts[0];

    browserProvider = new ethers.BrowserProvider(injected);
    signer = await browserProvider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

    const network = await browserProvider.getNetwork();
    if (network.chainId !== MONAD_CHAIN_ID) {
      log("⚠ Wrong network. Please switch wallet to Monad Mainnet (chainId 143) and reconnect.");
      setMintEnabled(false);
      return;
    }

    log("✅ Connected: " + walletAddress + "\nNetwork: Monad Mainnet");
    setMintEnabled(true);
  } catch (err) {
    log("❌ Connect error:\n" + (err.message || err));
  }
};

// mint
document.getElementById("mintBtn").onclick = async () => {
  try {
    if (!contract) {
      log("Connect wallet first.");
      return;
    }

    const qty = parseInt(document.getElementById("qty").value);
    if (!qty || qty < 1) {
      log("Quantity must be at least 1.");
      return;
    }

    const price = await contract.MINT_PRICE();
    const totalCost = price * BigInt(qty);

    log("⏳ Sending mint transaction…");

    const tx = await contract.mint(qty, { value: totalCost });
    log("⏳ Tx sent: " + tx.hash + "\nWaiting for confirmation…");

    const receipt = await tx.wait();
    log("✅ Mint confirmed!\nTx: " + receipt.hash);

    updateCounter();
  } catch (err) {
    log("❌ Mint error:\n" + (err.reason || err.message || err));
  }
};
</script>

</body>
</html>
